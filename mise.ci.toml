# SPDX-FileCopyrightText: 2025 Knitli Inc.
# SPDX-FileContributor: Adam Poulemanos <adam@knit.li>
#
# SPDX-License-Identifier: MIT OR Apache-2.0

# ============================================================================
# CI-Specific Mise Configuration
# ============================================================================
# This lightweight configuration is used in CI/CD environments when MISE_ENV=ci
# It includes only essential tools needed for testing and building, significantly
# reducing installation time and cache size.
#
# Usage in GitHub Actions:
#   - name: Setup mise
#     env:
#       MISE_ENV: ci
#     run: mise install
#
# NOTE: This configuration inherits from `mise.toml`, so these are additions/overrides
# ============================================================================
[settings]
status.show_env = false  # Reduce CI output noise

# ============================================================================
# Environment Variables
# ============================================================================
[env]
# Simplified PATH for CI
_.path = [".venv/bin", "bin"]

# ============================================================================
# CI Tasks
# ============================================================================

[tasks.build]
run = '''
#!/bin/bash
echo "Building package..."
uv build &&
echo "âœ… Package built successfully!"
'''

[tasks.docs-build]
tools.uv = "latest"
run = '''
#!/bin/bash
echo "Building documentation..."
uv run --group docs mkdocs build
'''

# Combined CI workflow
[tasks.ci]
run = [
  "mise //:check",
  "mise //:lint",
  "mise //:test-cov",
  "mise //:build",
]
description = "Run all CI checks (lightweight CI mode)"
