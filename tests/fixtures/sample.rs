[38;5;238mâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
     [38;5;238mâ”‚ [0m[1mSTDIN[0m
[38;5;238mâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[38;5;238m   1[0m [38;5;238mâ”‚[0m [38;2;248;248;242m// SPDX-FileCopyrightText: 2025 Knitli Inc.[0m
[38;5;238m   2[0m [38;5;238mâ”‚[0m [38;2;248;248;242m// SPDX-License-Identifier: MIT OR Apache-2.0[0m
[38;5;238m   3[0m [38;5;238mâ”‚[0m 
[38;5;238m   4[0m [38;5;238mâ”‚[0m [38;2;248;248;242m//! Sample Rust module for testing chunker functionality.[0m
[38;5;238m   5[0m [38;5;238mâ”‚[0m [38;2;248;248;242m//! Contains traits, impls, macros, and struct definitions.[0m
[38;5;238m   6[0m [38;5;238mâ”‚[0m 
[38;5;238m   7[0m [38;5;238mâ”‚[0m [38;2;248;248;242muse std::collections::HashMap;[0m
[38;5;238m   8[0m [38;5;238mâ”‚[0m [38;2;248;248;242muse std::fmt;[0m
[38;5;238m   9[0m [38;5;238mâ”‚[0m 
[38;5;238m  10[0m [38;5;238mâ”‚[0m [38;2;248;248;242m/// Trait for cacheable items[0m
[38;5;238m  11[0m [38;5;238mâ”‚[0m [38;2;248;248;242mpub trait Cacheable {[0m
[38;5;238m  12[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    fn cache_key(&self) -> String;[0m
[38;5;238m  13[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    fn is_valid(&self) -> bool;[0m
[38;5;238m  14[0m [38;5;238mâ”‚[0m [38;2;248;248;242m}[0m
[38;5;238m  15[0m [38;5;238mâ”‚[0m 
[38;5;238m  16[0m [38;5;238mâ”‚[0m [38;2;248;248;242m/// Data item with identifier and value[0m
[38;5;238m  17[0m [38;5;238mâ”‚[0m [38;2;248;248;242m#[derive(Debug, Clone)][0m
[38;5;238m  18[0m [38;5;238mâ”‚[0m [38;2;248;248;242mpub struct DataItem {[0m
[38;5;238m  19[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    pub id: String,[0m
[38;5;238m  20[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    pub value: i32,[0m
[38;5;238m  21[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    pub metadata: HashMap<String, String>,[0m
[38;5;238m  22[0m [38;5;238mâ”‚[0m [38;2;248;248;242m}[0m
[38;5;238m  23[0m [38;5;238mâ”‚[0m 
[38;5;238m  24[0m [38;5;238mâ”‚[0m [38;2;248;248;242mimpl Cacheable for DataItem {[0m
[38;5;238m  25[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    fn cache_key(&self) -> String {[0m
[38;5;238m  26[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        format!("item:{}", self.id)[0m
[38;5;238m  27[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    }[0m
[38;5;238m  28[0m [38;5;238mâ”‚[0m 
[38;5;238m  29[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    fn is_valid(&self) -> bool {[0m
[38;5;238m  30[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        !self.id.is_empty() && self.value >= 0[0m
[38;5;238m  31[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    }[0m
[38;5;238m  32[0m [38;5;238mâ”‚[0m [38;2;248;248;242m}[0m
[38;5;238m  33[0m [38;5;238mâ”‚[0m 
[38;5;238m  34[0m [38;5;238mâ”‚[0m [38;2;248;248;242mimpl fmt::Display for DataItem {[0m
[38;5;238m  35[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {[0m
[38;5;238m  36[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        write!(f, "DataItem(id={}, value={})", self.id, self.value)[0m
[38;5;238m  37[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    }[0m
[38;5;238m  38[0m [38;5;238mâ”‚[0m [38;2;248;248;242m}[0m
[38;5;238m  39[0m [38;5;238mâ”‚[0m 
[38;5;238m  40[0m [38;5;238mâ”‚[0m [38;2;248;248;242m/// Generic cache with type parameter[0m
[38;5;238m  41[0m [38;5;238mâ”‚[0m [38;2;248;248;242mpub struct Cache<T> {[0m
[38;5;238m  42[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    storage: HashMap<String, T>,[0m
[38;5;238m  43[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    max_size: usize,[0m
[38;5;238m  44[0m [38;5;238mâ”‚[0m [38;2;248;248;242m}[0m
[38;5;238m  45[0m [38;5;238mâ”‚[0m 
[38;5;238m  46[0m [38;5;238mâ”‚[0m [38;2;248;248;242mimpl<T: Cacheable> Cache<T> {[0m
[38;5;238m  47[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    pub fn new(max_size: usize) -> Self {[0m
[38;5;238m  48[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        Cache {[0m
[38;5;238m  49[0m [38;5;238mâ”‚[0m [38;2;248;248;242m            storage: HashMap::new(),[0m
[38;5;238m  50[0m [38;5;238mâ”‚[0m [38;2;248;248;242m            max_size,[0m
[38;5;238m  51[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        }[0m
[38;5;238m  52[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    }[0m
[38;5;238m  53[0m [38;5;238mâ”‚[0m 
[38;5;238m  54[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    pub fn insert(&mut self, item: T) -> Option<T> {[0m
[38;5;238m  55[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        if self.storage.len() >= self.max_size {[0m
[38;5;238m  56[0m [38;5;238mâ”‚[0m [38;2;248;248;242m            return None;[0m
[38;5;238m  57[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        }[0m
[38;5;238m  58[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        self.storage.insert(item.cache_key(), item)[0m
[38;5;238m  59[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    }[0m
[38;5;238m  60[0m [38;5;238mâ”‚[0m 
[38;5;238m  61[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    pub fn get(&self, key: &str) -> Option<&T> {[0m
[38;5;238m  62[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        self.storage.get(key)[0m
[38;5;238m  63[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    }[0m
[38;5;238m  64[0m [38;5;238mâ”‚[0m 
[38;5;238m  65[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    pub fn remove(&mut self, key: &str) -> Option<T> {[0m
[38;5;238m  66[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        self.storage.remove(key)[0m
[38;5;238m  67[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    }[0m
[38;5;238m  68[0m [38;5;238mâ”‚[0m [38;2;248;248;242m}[0m
[38;5;238m  69[0m [38;5;238mâ”‚[0m 
[38;5;238m  70[0m [38;5;238mâ”‚[0m [38;2;248;248;242m/// Macro for creating data items[0m
[38;5;238m  71[0m [38;5;238mâ”‚[0m [38;2;248;248;242m#[macro_export][0m
[38;5;238m  72[0m [38;5;238mâ”‚[0m [38;2;248;248;242mmacro_rules! data_item {[0m
[38;5;238m  73[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    ($id:expr, $value:expr) => {[0m
[38;5;238m  74[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        DataItem {[0m
[38;5;238m  75[0m [38;5;238mâ”‚[0m [38;2;248;248;242m            id: $id.to_string(),[0m
[38;5;238m  76[0m [38;5;238mâ”‚[0m [38;2;248;248;242m            value: $value,[0m
[38;5;238m  77[0m [38;5;238mâ”‚[0m [38;2;248;248;242m            metadata: HashMap::new(),[0m
[38;5;238m  78[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        }[0m
[38;5;238m  79[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    };[0m
[38;5;238m  80[0m [38;5;238mâ”‚[0m [38;2;248;248;242m}[0m
[38;5;238m  81[0m [38;5;238mâ”‚[0m 
[38;5;238m  82[0m [38;5;238mâ”‚[0m [38;2;248;248;242m#[cfg(test)][0m
[38;5;238m  83[0m [38;5;238mâ”‚[0m [38;2;248;248;242mmod tests {[0m
[38;5;238m  84[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    use super::*;[0m
[38;5;238m  85[0m [38;5;238mâ”‚[0m 
[38;5;238m  86[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    #[test][0m
[38;5;238m  87[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    fn test_cache_operations() {[0m
[38;5;238m  88[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        let mut cache = Cache::new(10);[0m
[38;5;238m  89[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        let item = data_item!("test", 42);[0m
[38;5;238m  90[0m [38;5;238mâ”‚[0m [38;2;248;248;242m        assert!(cache.insert(item).is_none());[0m
[38;5;238m  91[0m [38;5;238mâ”‚[0m [38;2;248;248;242m    }[0m
[38;5;238m  92[0m [38;5;238mâ”‚[0m [38;2;248;248;242m}[0m
[38;5;238mâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
